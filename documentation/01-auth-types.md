# Authentication Types:

### 1. Email LoopÂ 
- users can use their email addresses in order to sign up/sign into web applications
- This option is preferred when the target audience of the web app does not have a UST email account, but still would want to use this service using their own email (just like a "sign up with email" option on websites that you see. You can even do it with your St. Thomas Email, or just any email in general)
- You also have options for access control to restrict account creation via an admin, so that only the intended people have access to the web app

#### Types of Access Controls:
- Note: 
	- the only change required to use one type of access control is by editing the Cloudformation template. 
	- to change from one type of access control to the other, simply update the template with the code that is referenced below

1. Open To All (Self-Registration):
	- In this configuration setting, anyone can sign up with their email addresses into the web app
	- The sign up process usually involves the user receiving a verification code on their email that they need to enter in the Cognito Hosted UI
	- Once the sign up flow is completed, the user is added to the user pool, and can use their email and password to authenticate in the future
	- Users also have an option to go through the "forgot password" flow, which usually involves receiving a verification code in their email
	- [Template Code Example](../code-implementation-examples/email-loop.md#1-open-to-all-authentication-self-registration)

2. Invite-Only / Admin Control:
	- Accounts are generated by IT / Created on an invite-only basis (via AWS Cloud Console / AWS CLI)
	- When the account is generated, it will be in the "UNCONFIRMED" state, and the registration will be completed once the user sets the password of their account
	- In simple terms, the process is like this:
		1. \[You] Give admin your email
		2. \[Admin] goes into the web console -> AWS Cognito -> Selects the particular user pool -> Users -> Create user -> enter the fields, send user an invitation with a temporary password
		3. \[You] click on that invitation, set your new password, and congratulations now you have login access
	- [Template Code Example](../code-implementation-examples/email-loop.md#2-invite-only-admin-control)

3. Restricted By Domain / Whitelist:
	- Create a whitelist domain or a list of whitelisted emails that are allowed to register
	- For example, only allow emails with @stthomas.edu to register. This can be a good backup option in-case the Microsoft SSO Authentication is not working.
	- Uses a lambda trigger internally to look at the inputted email, and decide if it should proceed with the account creation flow based on the whitelist
	- [Template Code Example](../code-implementation-examples/email-loop.md#3-restricted-by-domain--whitelist)

### 2. SocialÂ / Third Party IdPs
- using public identity providers like Google, GitHub, etc to authenticate into the web app
- Not recommended for USTÂ appsÂ as we can use SSOÂ or Email
- Brief Setup Guide (even though no one will use it ðŸ¥º)
	1. **Register App on IdP Side:** Log into the provider's developer console (e.g., Google Cloud Console) and create an OAuth application.
    2. **Crucial Step:** Provide the provider with the following callback URL: `https://[Your Cognito Domain].auth.[Region].amazoncognito.com/oauth2/idpresponse` -> more on this when we get to the Entra Setup Discussion
    3. The provider returns a **Client ID** and **Client Secret**.
	4. **Configure Cognito (IaC):** Add a new `AWS::Cognito::UserPoolIdentityProvider` resource to your **Shared Auth Stack** using the `ProviderType: Google` (or Facebook, Apple, etc.) and supply the Client ID and Secret.
	5. **Map Attributes:** Map the provider's attributes (e.g., Google's `email`) to the corresponding Cognito attributes.
	6. **Enable on Client:** The Application Stack must explicitly list the new provider name in its `SupportedIdentityProviders` list (alongside `COGNITO` and/or `EntraID`).

### 3. Entra ID / SAML SSO Auth
- allows users to log into UST Web Apps using their UST Microsoft Emails, managed by Azure Active Directory (or Entra ID).
- The experience of signing in will be similar to that of the Social / Third Party IdPs, but with your UST Email
- This will be the exact same thing where you see a top-down shot of UST St. Paul Campus, with field to enter email and password on the right
- This is a two-step process where the first part of the process involves creating appropriate resources in IaC, and the second step is taken care by the Entra Admin's side when you give them the appropriate redirect urls and related values
